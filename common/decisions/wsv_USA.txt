###########################################################
# -  Socialist Movement
###########################################################

USA_socialist_movement_cat = {

	## socialist assembly incoming mission
	USA_socialist_rally_soon = {
		priority = 10
		icon = generic_form_nation

		allowed = { 
			original_tag = USA
		}

		activation = {
			NOT = { has_country_flag =  rally_cooldown }
		}
		
		days_mission_timeout = 30
		selectable_mission = yes
		cost = 10

		is_good = yes

		timeout_effect = {
			country_event = wsv_usa_labor.1
			set_country_flag = {
				flag = rally_cooldown
				value = 1
				days = 180
			}
		}

		complete_effect = {
			set_country_flag = {
				flag = rally_cooldown
				value = 1
				days = 200
			}
		}

		ai_will_do = {
			factor = 0.02
		}
	}
	

	################ STRIKES ################

	## strike mission (triggered by event)
	USA_strike_ongoing = {
		priority = 7
		icon = generic_civil_support

		allowed = { 
			original_tag = USA
		}
		
		activation = {
			has_idea = USA_worker_strikes
		}

		available = {
			NOT = { has_idea = USA_worker_strikes }
		}

		days_mission_timeout = 100
		selectable_mission = no
		is_good = no

		timeout_effect = {
			add_stability = -0.01
			add_war_support = -0.02
			custom_effect_tooltip = ends_current_strike_tt
			hidden_effect = {
				country_event = wsv_usa.3
				remove_ideas = USA_worker_strikes
				if = {
					limit = { has_country_flag = tightened_strike_laws }
					set_country_flag = { flag = strike_cooldown  value = 1  days = 350 }
				}
				else = {
					set_country_flag = { flag = strike_cooldown  value = 1  days = 250 }
				}
			}
		}
	}
	

	## appease strikers 
	USA_appease_strikers = {
		icon = ger_mefo_bills

		visible = {
			has_active_mission = USA_strike_ongoing
		}
		available = {
			has_active_mission = USA_strike_ongoing
		}
		cost = 50

		complete_effect = {
			hidden_effect = { remove_ideas = USA_worker_strikes }
			add_popularity = {
				ideology = communism
				popularity = 0.02
			}
			custom_effect_tooltip = ends_current_strike_tt
			if = {
				limit = { has_country_flag = tightened_strike_laws }
				set_country_flag = { flag = strike_cooldown  value = 1  days = 175 }
			}
			else = {
				set_country_flag = { flag = strike_cooldown  value = 1  days = 100 }
			}
		}

		ai_will_do = {
		 	factor = 0.03
		}
	}
	

	## crack down on strikers
	USA_break_up_strike = {
		icon = generic_prepare_civil_war

		visible = {
			has_active_mission = USA_strike_ongoing
		}
		available = {
			has_active_mission = USA_strike_ongoing
		}
		custom_cost_trigger = {
			command_power > 4.9
		}
		custom_cost_text = USA_decision_cost_crush_strike

		complete_effect = {
			hidden_effect = { 
				remove_ideas = USA_worker_strikes 
				add_command_power  = -5
			}
			custom_effect_tooltip = ends_current_strike_tt
			add_stability = -0.03
			if = {
				limit = { has_country_flag = tightened_strike_laws }
				set_country_flag = { flag = strike_cooldown  value = 1  days = 175 }
			}
			else = {
				set_country_flag = { flag = strike_cooldown  value = 1  days = 100 }
			}
		}

		ai_will_do = {
		 	factor = 0.015
			# give ai chance to maybe pay off strikers
			modifier = {
				factor = 0.5
				has_political_power < 50
			}
		}
	}


	############ SOCIALIST REVOLUTION ############

	## socialist militants forming
	# USA_socialist_militants_forming = {
	# 	priority = 1
	# 	icon = generic_prepare_civil_war

	# 	allowed = { 
	# 		original_tag = USA
	# 	}

	# 	activation = {
	# 		NOT = { has_country_flag =  militants_cooldown }
	# 		check_variable = { USA.usa_socialist_militancy > 49 }
	# 	}

	# 	available = {
	# 		NOT= { has_country_flag = USA_socialist_revolution }
	# 	}
		
	# 	days_mission_timeout = 30
	# 	selectable_mission = yes
		
	# 	custom_cost_trigger = {
	# 		command_power > 14.9
	# 	}
	# 	custom_cost_text = USA_decision_cost_socialist_militants_forming

	# 	is_good = yes

	# 	timeout_effect = {
	# 		increase_militancy_by_5_effect = yes
	# 		set_country_flag = {
	# 			flag = militants_cooldown
	# 			value = 1
	# 			days = 90
	# 		}
	# 	}

	# 	complete_effect = {
	# 		add_command_power = -15
	# 		set_country_flag = {
	# 			flag = militants_cooldown
	# 			value = 1
	# 			days = 90
	# 		}
	# 	}

	# 	ai_will_do = {
	# 		factor = 0.05
	# 	}
	# }

	## socialist revolution
	USA_imminent_revolution = {
		priority = 1
		icon = decision_revolt

		allowed = { 
			original_tag = USA
		}

		activation = {
			OR = {
				AND = {
					has_country_flag = wood_suspended_elections
					NOT = { has_country_flag = woods_stepped_down }
				}
				AND = {
					has_war = yes
					has_country_flag = USA_socialist_party_split
					NOT = { has_country_flag = revolution_delay }
				}
			}
		}

		days_mission_timeout = 200
		selectable_mission = no
		is_good = no

		timeout_effect = {
			news_event = wsv_usa_labor.100
		}
	}

	## TODO - decision allowing woods to step down (cancels revolution)
}



########## War Plans ##########

USA_warplans_cat = {

	USA_warplan_grey = {
		icon = generic_operation

		available = {
			has_war_with = CSA
		}
		visible = {
			has_country_flag = USA_war_plan_grey
		}

		fire_only_once = yes
		days_remove = 60
		days_re_enable = 0

		targeted_modifier = {
		    tag = CSA
		    attack_bonus_against = 0.15
		    #days = 60
		}
		
		remove_effect = {
		
		}

		ai_will_do = {
			factor = 10
		}
	}


	USA_warplan_red = {
		icon = generic_operation

		available = {
			has_war_with = CAN
		}
		visible = {
			has_country_flag = USA_war_plan_red
		}

		fire_only_once = yes
		days_remove = 60
		days_re_enable = 0

		targeted_modifier = {
		    tag = CAN
		    attack_bonus_against = 0.15
		    #days = 60
		}
		
		remove_effect = {
		
		}

		ai_will_do = {
			factor = 10
		}
	}

	USA_warplan_green = {
		icon = generic_operation

		available = {
			has_war_with = CAN
		}
		visible = {
			has_country_flag = USA_war_plan_green
		}

		fire_only_once = yes
		days_remove = 60
		days_re_enable = 0

		targeted_modifier = {
		    tag = MEX
		    attack_bonus_against = 0.15
		    #days = 60
		}
		
		remove_effect = {
		
		}

		ai_will_do = {
			factor = 10
		}
	}

	# USA_warplan_pink = {
	# 	icon = generic_operation

	# 	available = {
	# 		has_war_with = ENG
	# 	}
	# 	visible = {
	# 		has_country_flag = USA_war_plan_pink
	# 	}

	# 	fire_only_once = yes
	# 	days_remove = 30
	# 	days_re_enable = 0

	# 	complete_effect = {
	# 		random_country = {
	# 			limit = { controls_state = 690 }
	# 			save_event_target_as = country_that_holds_north_bahamas
	# 		}
	# 		random_country = {
	# 			limit = { controls_state = 693 }
	# 			save_event_target_as = country_that_holds_south_bahamas
	# 		}
	# 		random_country = {
	# 			limit = { controls_state = 696 }
	# 			save_event_target_as = country_that_holds_bermuda
	# 		}
	# 		690 = { add_dynamic_modifier = { modifier = generic_surprise_naval_assault scope = event_target:country_that_holds_north_bahamas } }
	# 		693 = { add_dynamic_modifier = { modifier = generic_surprise_naval_assault scope = event_target:country_that_holds_south_bahamas } }
	# 		696 = { add_dynamic_modifier = { modifier = generic_surprise_naval_assault scope = event_target:country_that_holds_bermuda } }
	# 	}

	# 	remove_effect = {
	# 		hidden_effect = {
	# 			every_state = {
	# 				limit = {
	# 					OR = { state = 690  state = 693 state = 696 }
	# 				}
	# 				remove_dynamic_modifier = { modifier = generic_surprise_naval_assault }
	# 			}
	# 		}
	# 	}

	# 	ai_will_do = {
	# 		factor = 10
	# 	}
	# }


	USA_warplan_blue = {
		icon = generic_operation

		available = {
			has_war_with = ENG
		}
		visible = {
			has_country_flag = USA_war_plan_blue
		}

		fire_only_once = yes
		days_remove = 30
		days_re_enable = 0

		complete_effect = {
			news_event = { id = wsv_usa.60  days = 1 }
			random_country = {
				limit = { controls_state = 629 }
				save_event_target_as = country_that_holds_hawaii
			}
			629 = {	add_dynamic_modifier = { modifier = generic_surprise_naval_assault scope = event_target:country_that_holds_hawaii } }
		}

		remove_effect = {
			hidden_effect = {
				629 = { remove_dynamic_modifier = { modifier = generic_surprise_naval_assault } }
			}
		}

		ai_will_do = {
			factor = 10
		}
	}
}



wsv_great_war_decisions = {

	USA_barrel_roll_offensive = {
		icon = generic_operation

		available = {
			has_war_with = CSA
		}
		visible = {
			has_country_flag = barrel_roll_offensive_flag
		}

		fire_only_once = yes
		days_remove = 0
		days_re_enable = 0

		complete_effect = {
			set_country_flag = barrel_roll_offensive_started
			add_timed_idea = {
				idea = USA_barrel_offensive_idea
				days = 60
			}
			hidden_effect = { activate_mission = USA_barrel_roll_mission }
		}

		ai_will_do = {
			factor = 10
		}
	}

	USA_barrel_roll_mission = {
	    activation = {
	    	has_country_flag = barrel_roll_offensive_started
	    }
	    cancel_trigger = {
	        NOT = { has_war_with = CSA }
	    }

	    icon = mission_icon     # For GFX_decision_mission_icon
	    days_mission_timeout = 90

	    timeout_effect = {
	        add_war_support = -0.15
	        add_political_power = -75
	        hidden_effect = { country_event = wsv_usa.3 }
	    }
	}

	
	# USA throws in the towel
	greatwar_usa_offers_peace = {

		icon = generic_form_nation

		available = {
			always = yes
			OR = {
				casualties > 500000
				surrender_progress > 0.5
			}
		}

		visible = {
			tag = USA
			has_war_with = CSA
			has_global_flag = historical_treaties_on
			has_start_date < 1937.1.1
		}

		days_remove = 5

		days_re_enable = 90

		remove_effect = {
			CSA = { country_event = wsv_ahistorical_treaty.16 }
			custom_effect_tooltip = baltimore_treaty_tt
		}

		# this is done by adding and subtracting a combination of modifiers, any positive value will get the ai to surrender
		ai_will_do = {
			factor = 0

			# Negatives
			modifier = {
				add = -1
				surrender_progress < 0.10
			}
			modifier = {
				add = -1
				surrender_progress < 0.15
			}
			modifier = {
				add = -1
				surrender_progress < 0.25
			}
			modifier = {
				add = -1
				surrender_progress < 0.35
			}
			# if not fighting two fronts, less likely to surrender
			modifier = {
				add = -1
				OR = {
					NOT = { has_war_with = CSA }
					NOT = { has_war_with = CAN }
				}
			}

			# Positives
			modifier = {
				add = 1
				casualties > 1000000
			}
			modifier = {
				add = 1
				casualties > 1500000
			}		
			modifier = {
				add = 1
				casualties > 2000000
			}
			modifier = {
				add = 1
				casualties > 2500000
			}	
			modifier = {
				add = 1
				casualties > 3000000
			}
			modifier = {
				add = 1
				casualties > 4000000
			}	

			modifier = {
				add = 10
				surrender_progress > 0.55
			}
		}
	}
}


######################################################################
#########################  WORLD WAR 2  ##############################
######################################################################
