
### WAR PLANS


## Influence in Caribbean ##

CSA_influence_in_caribbean_category = {

	CSA_conduct_naval_exercise = {

		icon = generic_naval

		visible = {
			always = yes
		}
		available = {
			has_war = no
		}

		cost = 15
		days_remove = 14
		days_re_enable = 120

		remove_effect = {
			add_to_variable = { 
				var = CSA.csa_influence_in_caribbean
				value = 5 
			}
			custom_effect_tooltip = increase_influence_by_5_tt
		}

		ai_will_do = {
			factor = 0.03
			# make confederates spend to get up quickly
			modifier = {
				factor = 500
				check_variable = { CSA.csa_influence_in_caribbean  < 10 }
			}

			#increase likelyhood if US is close to us
			modifier = {
				factor = 2
				check_variable = { CSA.csa_influence_edge < 10 }
			}
			modifier = {
				factor = 1.5
				check_variable = { CSA.csa_influence_edge < 20 }
			}
			# decrease if we have over 30
			modifier = {
				factor = 0.25
				check_variable = { CSA.csa_influence_edge < 30 }
			}
		}
	}

	## temporary ##
	CSA_expand_united_fruit_branch = {

		icon = generic_construction

		visible = {
			always = yes
			has_country_flag = unlocked_united_fruit_flag
		}
		available = {
			has_war = no
		}

		cost = 25
		days_remove = 14
		days_re_enable = 180

		remove_effect = {
			add_offsite_building = { type = industrial_complex level = 1 }
			add_to_variable = { 
				var = CSA.csa_influence_in_caribbean
				value = 10 
			}
			custom_effect_tooltip = increase_influence_by_10_tt
		}

		ai_will_do = {
			factor = 0.03

			# increase likelyhood if US is close to us
			# modifier = {
			# 	factor = 2
			# 	check_variable = { CSA.csa_influence_edge < 10 }
			# }
			# modifier = {
			# 	factor = 1.5
			# 	check_variable = { CSA.csa_influence_edge < 20 }
			# }
			# # decrease if we have over 30
			# modifier = {
			# 	factor = 0.25
			# 	check_variable = { CSA.csa_influence_edge < 30 }
			# }
		}
	}

	## temporary ##
	CSA_intervention_in_caribbean = {

		icon = infiltrate_state

		visible = {
			has_country_flag = unlocked_intervention_flag
		}
		available = {
			has_war = no
			NOT= { has_country_flag = CSA_recently_conducted_intervention_flag }
			FROM = {
				NOT = { is_guaranteed_by = USA }
				NOT = { is_in_faction_with = USA }
			}
		}

		targets = { GUA HON ELS NIC COS }

		target_trigger = {
			FROM = {
				NOT = { has_war_with = CSA }
				is_puppet = no
			}
		}
		
		cost = 75
		days_remove = 25

		complete_effect = {
			set_country_flag = {
				flag = CSA_recently_conducted_intervention_flag
				days = 115
			}
		}

		remove_effect = {
			add_threat = 2
			puppet = FROM
			add_to_variable = { 
				var = CSA.csa_influence_in_caribbean
				value = 10 
			}
			custom_effect_tooltip = increase_influence_by_10_tt
			#hidden_effect = { news_event = { id =  days = 1 } }
			# TOOD: news event of intervention
		}

		ai_will_do = {
			factor = 0.003  
			modifier = {
				factor = 1.5
				tag = NIC
			}
		}
	}


	## (FUTURE WORK) ##
	# CSA_establish_united_fruit_branch = {

	# 	icon = generic_construction

	# 	visible = {
	# 		has_country_flag = unlocked_united_fruit_flag
	# 	}

	# 	targets = { DOM GUA HON ELS NIC COS COL VEN }

	# 	target_trigger = {
	# 		FROM = {
	# 			NOT = { has_country_flag = united_fruit_established }
	# 			NOT = { has_war_with = CSA }
	# 			is_puppet = no
	# 		}
	# 	}
		
	# 	cost = 40
	# 	days_remove = 14

	# 	complete_effect = {
	# 		set_country_flag = building_fruit_branch
	# 	}

	# 	remove_effect = {
	# 		clr_country_flag = building_fruit_branch
	# 		FROM = { set_country_flag = united_fruit_established }
	# 		add_to_variable = { 
	# 			var = CSA.csa_influence_in_caribbean
	# 			value = 5 
	# 		}
	# 		add_offsite_building = { type = industrial_complex level = 1 }
	# 		custom_effect_tooltip = increase_influence_by_5_tt
	# 		# TODO: hidden effect, send event notice to the US
	# 	}

	# 	ai_will_do = {
	# 		factor = 0.01

	# 		modifier = {
	# 			factor = 0
	# 			has_country_flag = building_fruit_branch
	# 		}
	# 		modifier = {
	# 			factor = 4
	# 			tag = DOM
	# 		}
	# 		modifier = {
	# 			factor = 2
	# 			OR = {
	# 				tag = COL
	# 				tag = NIC
	# 			}
	# 		}
			
	# 		# increase likelyhood if US is high
	# 		modifier = {
	# 			factor = 2
	# 			check_variable = { var = USA.usa_influence_in_caribbean value = 20 compare = greater_than_or_equals }
	# 		}
	# 		modifier = {
	# 			factor = 2
	# 			check_variable = { var = USA.usa_influence_in_caribbean value = 40 compare = greater_than_or_equals }
	# 		}
	# 		modifier = {
	# 			factor = 2
	# 			check_variable = { var = USA.usa_influence_in_caribbean value = 60 compare = greater_than_or_equals }
	# 		}

	# 		# decrease likelyhood if ours is high
	# 		modifier = {
	# 			factor = 0.5
	# 			check_variable = { var = CSA.csa_influence_in_caribbean value = 25 compare = greater_than_or_equals }
	# 		}
	# 		modifier = {
	# 			factor = 0.5
	# 			check_variable = { var = CSA.csa_influence_in_caribbean value = 50 compare = greater_than_or_equals }
	# 		}
	# 		modifier = {
	# 			factor = 0.5
	# 			check_variable = { var = CSA.csa_influence_in_caribbean value = 75 compare = greater_than_or_equals }
	# 		}
	# 	}
	# }

	## (FUTURE WORK) ##
	# CSA_intervention_in_caribbean = {

	# 	icon = infiltrate_state

	# 	visible = {
	# 		has_country_flag = unlocked_intervention_flag
	# 		FROM = {
	# 			has_country_flag = csa_can_intervene_flag
	# 		}
	# 	}
	# 	available = {
	# 		FROM = {
	# 			NOT = { is_guaranteed_by = USA }
	# 			NOT = { is_in_faction_with = USA }
	# 		}
	# 	}

	# 	targets = { DOM GUA HON ELS NIC COS }

	# 	target_trigger = {
	# 		FROM = {
	# 			NOT = { has_war_with = CSA }
	# 			is_puppet = no
	# 		}
	# 	}
		
	# 	cost = 50
	# 	days_remove = 14

	# 	remove_effect = {
	# 		FROM = {
	# 			save_event_target_as = target_of_csa_intervention
	# 		}
	# 		USA = { country_event = { id = wsv_csa.11 days = 1 } }   #us gets info that csa invaded, which starts intervention chain
	# 		custom_effect_tooltip = attempt_to_puppet_tt
	# 	}

	# 	ai_will_do = {
	# 		factor = 0.005  
	# 		modifier = {
	# 			factor = 2
	# 			OR = { tag = DOM   tag = NIC }
	# 		}
	# 		modifier = {
	# 			factor = 0.5
	# 			has_global_flag = us_threatened_cs_over_caribbean
	# 		}
	# 		modifier = {
	# 			factor = 0
	# 			AND = {
	# 				has_global_flag = us_threatened_cs_over_caribbean
	# 				is_historical_focus_on = yes
	# 			}
	# 		}
	# 	}
	#}
}


## Red Rebellion ##

CSA_red_rebellion_management_cat = {


	CSA_red_rebels_resistance_escalation_mission = {
	
		priority = 9
		icon = generic_scorched_earth

		allowed = { 
			original_tag = CSA
		}
		available = {
			NOT = {
		    	371 = { has_state_flag = contains_red_rebels }
				370 = { has_state_flag = contains_red_rebels }
				367 = { has_state_flag = contains_red_rebels }
				365 = { has_state_flag = contains_red_rebels }
				364 = { has_state_flag = contains_red_rebels }
				363 = { has_state_flag = contains_red_rebels }
				362 = { has_state_flag = contains_red_rebels }
			}
		}

		days_mission_timeout = 30

		fire_only_once = no

		activation = {
			has_global_flag = csa_black_revolt_occured
			any_owned_state = {
				has_state_flag = contains_red_rebels
			}
			NOT = {
				has_country_flag = CSA_red_rebels_resistance_cooldown
			}
		}

		is_good = no

		timeout_effect = {
			random_owned_state = {
				limit = {
					has_state_flag = contains_red_rebels
				}
				save_global_event_target_as = CSA_red_rebels_state_event_target
			}
			random_list = {
				# black rebels escalate
				88 = { 
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_escalate_state_effect = yes
					}
					country_event = wsv_csa.26  # notice of escalation
				}
				# black rebels pushed back
				22 = {
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes   
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
			}
			set_country_flag = {
				flag = CSA_red_rebels_resistance_cooldown
				value = 1
				days = 14
			}
		}

		complete_effect = {
			set_global_flag = csa_red_rebellion_defeated
			hidden_effect = { news_event = { id = wsv_news.22  days = 2 } }
		}
	}


	CSA_counter_rebels_in_virginia = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 362
			362 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 362
			362 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 362 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			362 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.3  # virginia more important
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}


	CSA_counter_rebels_in_north_carolina = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 363
			363 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 363
			363 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 363 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			363 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.1
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}


	CSA_counter_rebels_in_south_carolina = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 364
			364 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 364
			364 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 364 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			364 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.1
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}


	CSA_counter_rebels_in_gerogia = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 365
			365 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 365
			365 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 365 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			365 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.2 #georgia a little more importanmt
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}


	CSA_counter_rebels_in_alabama = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 367
			367 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 367
			367 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 367 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			367 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.2  #alabama a little more importanmt
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}


	CSA_counter_rebels_in_missisippi = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 370
			370 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 370
			370 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 370 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			370 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.1
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}


	CSA_counter_rebels_in_louisiana = {

		icon = red_rebellion_state

		available = {
			has_global_flag = csa_black_revolt_occured
			controls_state = 371
			371 = { 
				has_state_flag = contains_red_rebels 
				NOT = { has_state_flag = anti_rebel_operation_cooldown }
			}
		}

		visible = {
			controls_state = 371
			371 = { has_state_flag = contains_red_rebels }
		}

		highlight_states = {
			highlight_states_trigger = { state = 371 }
		}

		on_map_mode = map_only

		custom_cost_trigger = {
			command_power > 9.9
		}

		custom_cost_text = CSA_decision_cost_red_rebels

		complete_effect = {
			add_command_power = -10
			371 = { 
				save_global_event_target_as = CSA_red_rebels_state_event_target 
				set_state_flag = {
					flag = anti_rebel_operation_cooldown
					value = 1
					days = 14
				}
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0.82
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_enclave } } 
					}
					modifier = {
						factor = 0.68
						event_target:CSA_red_rebels_state_event_target = { has_dynamic_modifier = { modifier = CSA_red_stronghold } } 
					}
					event_target:CSA_red_rebels_state_event_target = { 
						CSA_black_rebels_pacify_state_effect = yes 
						if = { 
							limit = { has_state_flag = contains_red_rebels } 
							ROOT = { country_event = wsv_csa.27 }   # successful attack
						}
						else = {
							ROOT = { country_event = wsv_csa.29 }   # red rebels cleared
						}
					}
				}
				50 = {
					country_event = wsv_csa.28  # notice of failed attack
				}
			}
		}

		ai_will_do = {
			factor = 0.1
			#try to prevent enclaves becoming strongholds
			modifier = {
				factor = 4
				has_dynamic_modifier = { modifier = CSA_red_enclave } 
			}
			#if its a stronghold leave it for the end
			modifier = {
				factor = 0.5
				has_dynamic_modifier = { modifier = CSA_red_stronghold }  
			}
			# dont burn command power
			modifier = {
				factor = 0.5
				command_power < 41
			}
			modifier = {
				factor = 0.5
				command_power < 21
			}
		}
	}
}





### GREAT WAR SURRENDER

wsv_great_war_decisions = {

	# plan to invade the us
	CSA_warplan_lee = {

		icon = generic_operation

		available = {
			has_war_with = USA
		}
		visible = {
			has_country_flag = CSA_warplan_lee_flag
		}

		fire_only_once = yes
		days_remove = 60
		days_re_enable = 0

		# targeted_modifier = {
		#     tag = USA
		#     defense_bonus_against = -0.1
		#     #days = 60
		# }
		
		complete_effect = {
			every_state = {
				limit = {
					OR = { state = 361  state = 360  state = 840}
				}
				add_dynamic_modifier = { modifier = CSA_warplan_lee_modifier scope = CSA }
			}
		}

		remove_effect = {
			hidden_effect = {
				every_state = {
					limit = {
						OR = { state = 361  state = 360  state = 840}
					}
					remove_dynamic_modifier = { modifier = CSA_warplan_lee_modifier }
				}
			}
		}

		ai_will_do = {
			factor = 10
		}
	}
	
	# CSA throws in the towel
	greatwar_csa_offers_peace = {

		icon = generic_form_nation

		available = {
			OR = {
				casualties > 300000
				surrender_progress > 0.5
			}
		}

		visible = {
			tag = CSA
			has_war_with = USA
			has_global_flag = historical_treaties_on
			has_start_date < 1937.1.1
		}

		days_remove = 0

		days_re_enable = 90

		remove_effect = {
			USA = { country_event = wsv_historical_treaty.4 }
			custom_effect_tooltip = nashville_treaty_tt
		}

		# this is done by adding and subtracting a combination of modifiers, any positive value will get the ai to surrender
		ai_will_do = {
			factor = 0

			# Negatives
			modifier = {
				add = -1
				surrender_progress < 0.10
			}
			modifier = {
				add = -1
				surrender_progress < 0.15
			}
			modifier = {
				add = -1
				surrender_progress < 0.25
			}
			modifier = {
				add = -1
				surrender_progress < 0.35
			}

			# Positives
			modifier = {
				add = 1
				casualties > 700000
			}	
			modifier = {
				add = 1
				casualties > 1000000
			}
			modifier = {
				add = 1
				casualties > 1500000
			}
			modifier = {
				add = 1
				casualties > 2000000
			}
			modifier = {
				add = 1
				NOT = { has_war_together_with = FRA }
			}
			modifier = {
				add = 1
				NOT = { has_war_together_with = ENG }
			}

			modifier = {
				add = 10
				surrender_progress > 0.55
			}
		}
	}
}





######################################################################
#########################  WORLD WAR 2  ##############################
######################################################################


wsv_ww2_decisions = {
	
	operation_blackbeard = {

		icon = generic_tank

		allowed = {
			original_tag = CSA
		}

		visible = {
			has_government = fascism
			NOT = { has_war_with = USA }
			NOT = { is_in_faction_with = USA }
            OR = {
            	has_completed_focus = CSA2_operation_blackbeard
            	GER = { has_war = yes }
            }
		}

		#war_with_on_complete = USA

		targeted_modifier = {
		    tag = USA
		    defense_bonus_against = -0.1
		    #days = 60
		}

		days_remove = 7

		fire_only_once = yes

		remove_effect = {
			set_global_flag = operation_blackbeard_commenced
			CSA = { 
				declare_war_on = {
				    target = USA
				    type = topple_government
				}
				#add_timed_idea = { days = 60   idea = CSA_operation_blackbeard_idea } 
				261 = {
					add_dynamic_modifier = {
						modifier = CSA_operation_blackbeard_modifier
						scope = CSA # optional, if you specify this your dynamic modifier scoped to this scope (root is the effect scope)
						days = 60 # optional, will be removed after this many days passes
					}
				}
			}
			hidden_effect = { news_event = wsv_ww2_csa.5 }
		}

		ai_will_do = {
			factor = 0
			modifier = {
				add = 100
				GER = {
					OR = { 
						has_war_with = ENG
						has_war_with = FRA
						has_war_with = RUS
					}
				}
			}
		}
	}
}