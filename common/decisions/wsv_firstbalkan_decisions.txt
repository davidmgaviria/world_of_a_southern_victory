###################################################
# -- Forming Balkan League
###################################################

balkan_league_cat = {

	# Serbia / Bulgaria asks the other to form Balkan League
	request_balkanleauge_formation = {
		#icon = generic_civil_support  #generic icon

		allowed = {
			OR = {
				original_tag = SER
				original_tag = BUL
			}
		}
		visible = {
			OR = {
				date > 1912.1.1
				has_global_flag = italoturkish_war
			}
			NOT = { has_global_flag = balkan_requests_sent_out }
		}
		available = {
			has_war = no
			# TODO: check if anyone can join balkan league
		}

		cost = 25
		fire_only_once = yes

		complete_effect = {
			set_global_flag = balkan_requests_sent_out
			every_country = {
				limit = {
					NOT = { tag = ROOT }
					OR = {
						tag = SER
						tag = BUL
						tag = GRE
						tag = MNT
					}
					has_war = no
					is_in_faction = no
					is_puppet = no	
				}
				country_event = wsv_firstbalkan.1
			}
			custom_effect_tooltip = balkan_league_join_conditions_tt
		}

		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 10
				tag = SER
				is_historical_focus_on = yes
			}
			modifier = {
				factor = 0
				tag = BUL
				is_historical_focus_on = yes
			}
		}
	}


	# Negociate territorial differences
	balkanleague_territorial_negociations = {
		icon = generic_political_discourse

		visible = {
			OR = {
				date > 1912.1.1
				has_global_flag = italoturkish_war
			}
			has_country_flag = balkan_league_memeber
			NOT = { has_global_flag = balkan_league_negociations }
		}
		available = {
			has_war = no
			has_global_flag = balkan_league_formed
		}

		cost = 50
		fire_only_once = yes
		
		complete_effect = {
			set_global_flag = balkan_league_negociations
			every_country = {
				limit = { has_country_flag = balkan_league_member }
				country_event = wsv_firstbalkan.4
			}
		}

		ai_will_do = {
			factor = 1
		}
	}

	# Ongoing negociations mission
	balkanleague_ongoing_negociations = {
		icon = generic_political_discourse

		visible = {
			has_country_flag = balkan_league_memeber
		}
		activation = {
			has_global_flag = balkan_league_negociations
		}
		available = {
			has_global_flag = balkan_league_negociations_over  # mission to cancel
		}

		days_mission_timeout = 180
		is_good = no
		
		timeout_effect = {
			set_global_flag = balkan_league_negociations_over
			every_country = {
				limit = { has_country_flag = balkan_league_member }
				country_event = wsv_firstbalkan.5
			}
		}
	}

	# Declare the balkan war
	balkanleague_begin_war = {
		icon = generic_prepare_civil_war

		visible = {
			OR = {
				date > 1912.1.1
				has_global_flag = italoturkish_war
			}
			has_global_flag = balkan_league_formed
			has_country_flag = balkan_league_memeber
			NOT = { has_global_flag =  kis_firstbalkan_war }
		}
		available = {
			has_war = no
			has_global_flag = balkan_league_negociations_over
			is_faction_leader = yes
		}

		cost = 25
		fire_only_once = yes
		days_remove = 7

		remove_effect = {
			declare_war_on = {
				target = TUR
				type = take_core_state
			}
			hidden_effect = {
				every_country = {
					limit = { is_in_faction_with = ROOT }
					add_to_war = {
						targeted_alliance = ROOT
						enemy = TUR
					}
				}
			}
			news_event = wsv_firstbalkan.6
		}

		ai_will_do = {
			factor = 1
		}
	}
}




###################################################
# -- First Balkan War
###################################################

firstbalkan_war_cat = {

	# Turkey throws in the towel
	firstbalkan_turkey_offers_peace = {
		icon = generic_form_nation

		allowed = {
			tag = TUR
		}
		available = {
			OR = {
				casualties > 50000
				surrender_progress > 0.25
			}
		}
		visible = {
			has_global_flag = kis_firstbalkan_war
			NOT = { has_global_flag = kis_firstbalkanwar_victory }
			OR = {
				has_war_with = SER
				has_war_with = BUL
			}
		}

		days_remove = 3

		days_re_enable = 60

		remove_effect = {
			if = {
				limit = { SER = { is_faction_leader = yes } }
				SER = { country_event = ww1_firstbalkan.6 }
			}
			if = {
				limit = { BUL = { is_faction_leader = yes } }
				BUL = { country_event = ww1_firstbalkan.6 }
			}
			custom_effect_tooltip = firstbalkan_league_wins_tt
		}

		# this is done by adding and subtracting a combination of modifiers, any positive value will get the ai to surrender
		ai_will_do = {
			factor = 0

			# less likely to give up if holding northern balkans
			modifier = {
				add = -1
				controls_state = 760
				controls_state = 761
				controls_state = 44
				controls_state = 106
				controls_state = 803
				controls_state = 758
			}

			# less likely to give up if holding southern balkans
			modifier = {
				add = -1
				controls_state = 759
				controls_state = 731
				controls_state = 788
				controls_state = 184
			}

			# start losing interest when casualties mount
			modifier = {
				add = 1
				OR = {
					casualties_inflicted_by = {
					    opponent = ser
					    thousands > 50
					}
					casualties_inflicted_by = {
					    opponent = BUL
					    thousands > 50
					}
				}
			}

			# god so many casualties
			modifier = {
				add = 1
				OR = {
					casualties_inflicted_by = {
					    opponent = ser
					    thousands > 75
					}
					casualties_inflicted_by = {
					    opponent = BUL
					    thousands > 75
					}
				}
			}

			# balkans isnt worth this much blood
			modifier = {
				add = 1
				OR = {
					casualties_inflicted_by = {
					    opponent = ser
					    thousands > 100
					}
					casualties_inflicted_by = {
					    opponent = BUL
					    thousands > 100
					}
				}
			}

			# if we lose istanbul give up
			modifier = {
				add = 10
				NOT = { controls_state = 341 }  
			}
		}
	}


	# Balkan league offers peace
	firstbalkan_league_offers_peace = {
		icon = generic_form_nation

		allowed = {
			OR = {
				tag = SER
				tag = BUL
			}
		}
		available = {
			casualties_inflicted_by = {
			    opponent = TUR
			    thousands > 50
			}
			OR = {
				alliance_strength_ratio < 1
				TUR = { surrender_progress < 0.05 }
			}
		}
		visible = {
			has_global_flag = kis_firstbalkan_war
			NOT = { has_global_flag = kis_firstbalkanwar_victory }
			has_war_with = TUR
			is_faction_leader = yes
		}

		days_remove = 3

		days_re_enable = 60

		remove_effect = {
			TUR = { country_event =  ww1_firstbalkan.7 }
			custom_effect_tooltip = firstbalkan_turkey_wins_tt
		}

		ai_will_do = {
			factor = 0

			# less likely to give up if holding northern balkans
			modifier = {
				add = -1
				controls_state = 760
				controls_state = 761
				controls_state = 44
				controls_state = 106
				controls_state = 803
				controls_state = 758
			}

			# less likely to give up if holding southern balkans
			modifier = {
				add = -1
				controls_state = 759
				controls_state = 731
				controls_state = 788
				controls_state = 184
			}

			# start losing interest when casualties mount
			modifier = {
				add = 1
				OR = { 
					AND = {
						tag = BUL
						casualties > 75000
					}
					AND = {
						tag = SER
						casualties > 60000
					}
				}
			}

			modifier = {
				add = 1
				OR = { 
					AND = {
						tag = BUL
						casualties > 100000
					}
					AND = {
						tag = SER
						casualties > 85000
					}
				}
			}

			modifier = {
				add = 1
				OR = { 
					AND = {
						tag = BUL
						casualties > 150000
					}
					AND = {
						tag = SER
						casualties > 125000
					}
				}
			}
		}
	}
}